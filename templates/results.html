{% extends "base.html" %}

{% block title %}Detection Results - Criminal Face Detection System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <!-- Detection Results -->
        <div class="card">
            <div class="card-header {% if detection.match_found %}bg-success{% else %}bg-warning{% endif %} text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-{% if detection.match_found %}check-circle{% else %}exclamation-triangle{% endif %} me-2"></i>
                    Detection Results
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-muted mb-3">Uploaded Image</h6>
                        <div class="detection-image">
                            <img src="{{ url_for('uploaded_file', filename=detection.image_filename) }}" 
                                 alt="Uploaded image" 
                                 class="img-fluid rounded border">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-muted mb-3">Analysis Results</h6>
                        
                        {% if detection.match_found %}
                            <!-- Match Found -->
                            <div class="alert alert-success">
                                <h4 class="alert-heading">
                                    <i class="fas fa-check-circle me-2"></i>Match Found!
                                </h4>
                                <p class="mb-2">The uploaded image matches a record in our criminal database.</p>
                                <hr>
                                <p class="mb-0">
                                    <strong>Confidence Score:</strong> 
                                    <span class="badge bg-success">{{ "%.1f"|format(detection.confidence_score) }}%</span>
                                </p>
                            </div>
                            
                            <div class="criminal-details">
                                <h5 class="mb-3">Criminal Record Details</h5>
                                
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="criminal-photo-large">
                                            {% if detection.criminal.image_filename %}
                                                <img src="{{ url_for('uploaded_file', filename=detection.criminal.image_filename) }}" 
                                                     alt="{{ detection.criminal.name }}" 
                                                     class="img-fluid rounded border">
                                            {% else %}
                                                <div class="criminal-photo-placeholder-large">
                                                    <i class="fas fa-user fa-3x"></i>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <table class="table table-borderless">
                                            <tr>
                                                <td><strong>Name:</strong></td>
                                                <td>{{ detection.criminal.name }}</td>
                                            </tr>
                                            {% if detection.criminal.alias %}
                                                <tr>
                                                    <td><strong>Alias:</strong></td>
                                                    <td><span class="badge bg-secondary">{{ detection.criminal.alias }}</span></td>
                                                </tr>
                                            {% endif %}
                                            <tr>
                                                <td><strong>Crime Type:</strong></td>
                                                <td><span class="badge bg-danger">{{ detection.criminal.crime_type }}</span></td>
                                            </tr>
                                            <tr>
                                                <td><strong>Date Added:</strong></td>
                                                <td>{{ detection.criminal.date_added.strftime('%Y-%m-%d') }}</td>
                                            </tr>
                                            {% if detection.criminal.description %}
                                                <tr>
                                                    <td><strong>Description:</strong></td>
                                                    <td>{{ detection.criminal.description }}</td>
                                                </tr>
                                            {% endif %}
                                        </table>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <!-- No Match Found -->
                            <div class="alert alert-warning">
                                <h4 class="alert-heading">
                                    <i class="fas fa-exclamation-triangle me-2"></i>No Match Found
                                </h4>
                                <p class="mb-0">The uploaded image does not match any records in our criminal database.</p>
                            </div>
                            
                            <div class="no-match-info">
                                <h5 class="mb-3">Analysis Details</h5>
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check text-success me-2"></i>Face detection: Successful</li>
                                    <li><i class="fas fa-search text-primary me-2"></i>Database comparison: Complete</li>
                                    <li><i class="fas fa-times text-warning me-2"></i>Criminal match: Not found</li>
                                </ul>
                                
                                <div class="mt-4 p-3 bg-light rounded">
                                    <h6 class="mb-2">What this means:</h6>
                                    <p class="mb-0 small text-muted">
                                        The person in the uploaded image is either not in our database or the image quality/angle 
                                        is not sufficient for accurate matching. Consider adding this person to the database if they 
                                        are a person of interest.
                                    </p>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <!-- Detection Metadata -->
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle me-2"></i>Detection Metadata
                </h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tr>
                        <td><strong>Detection ID:</strong></td>
                        <td>{{ detection.id }}</td>
                    </tr>
                    <tr>
                        <td><strong>Timestamp:</strong></td>
                        <td>{{ detection.detection_date.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    </tr>
                    <tr>
                        <td><strong>Image File:</strong></td>
                        <td>{{ detection.image_filename }}</td>
                    </tr>
                    <tr>
                        <td><strong>Status:</strong></td>
                        <td>
                            {% if detection.match_found %}
                                <span class="badge bg-success">Match Found</span>
                            {% else %}
                                <span class="badge bg-warning text-dark">No Match</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% if detection.match_found %}
                        <tr>
                            <td><strong>Confidence:</strong></td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="progress flex-grow-1 me-2" style="height: 20px;">
                                        <div class="progress-bar {% if detection.confidence_score >= 80 %}bg-success{% elif detection.confidence_score >= 60 %}bg-warning{% else %}bg-danger{% endif %}" 
                                             style="width: {{ detection.confidence_score }}%">
                                            {{ "%.1f"|format(detection.confidence_score) }}%
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    {% endif %}
                </table>
            </div>
        </div>
        
        <!-- Actions -->
        <div class="card mt-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-cogs me-2"></i>Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('index') }}" class="btn btn-primary">
                        <i class="fas fa-search me-2"></i>Analyze Another Image
                    </a>
                    
                    {% if not detection.match_found %}
                        <a href="{{ url_for('database') }}" class="btn btn-success">
                            <i class="fas fa-plus me-2"></i>Add to Database
                        </a>
                    {% endif %}
                    
                    <a href="{{ url_for('database') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-database me-2"></i>View Database
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Confidence Score Explanation -->
        {% if detection.match_found %}
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-question-circle me-2"></i>Confidence Score Guide
                    </h6>
                </div>
                <div class="card-body">
                    <div class="confidence-guide">
                        <div class="mb-2">
                            <span class="badge bg-success me-2">80-100%</span>
                            <small>Very High Confidence</small>
                        </div>
                        <div class="mb-2">
                            <span class="badge bg-warning text-dark me-2">60-79%</span>
                            <small>Moderate Confidence</small>
                        </div>
                        <div class="mb-2">
                            <span class="badge bg-danger me-2">40-59%</span>
                            <small>Low Confidence</small>
                        </div>
                        <div>
                            <span class="badge bg-secondary me-2">&lt;40%</span>
                            <small>Very Low Confidence</small>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
